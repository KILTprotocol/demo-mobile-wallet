### Installation:
```bash
npm install @ethernom/ethernom-api
```

### API CALLS:

### How-To: Initialize EthernomAPI:
Parameter: {<br />
	transportType 	= "USB", "BLE" & "NFC",<br />
	API_ID 			= 0x00 ~ 0xFF,<br />
	secsTimeout 	= -1 (Doesn't timeout) or possitive integer,<br />
	allowDuplicates = true or false,<br />
	stopScanOnWrite = true or false,<br />
	Callback function<br />
}<br />
Callback: resultCode
```bash
import {EthernomAPI} from "ethernom-api";
var MAIN_E_API = await new EthernomAPI(transportType, API_ID, secsTimeout, allowDuplicates, stopScanOnWrite, (resultCode) =>{
	if (resultCode == ETH_SUCCESS){
		//Initialize success
		MAIN_E_API.DiscoverDevices(this._device_discovery);
		/*
		...
		Can start using other EthernomAPI calls
		...
		*/
	}else{
		//Initialize fail
	}
});
```
<br />

### How-To: Discovery devices:
Parameter: Callback function<br />
Callback: resultCode, deviceID and deviceName
```bash
MAIN_E_API.DiscoverDevices(this._device_discovery);
_device_discovery = (resultCode, deviceID, deviceName, deviceSN) => {
	console.log(deviceID);
	console.log(deviceName):
	console.log(deviceSN):
}
```
<br />

### How-To: Stop discovery devices:
```bash
MAIN_E_API.StopDiscovery();
```
<br />

### How-To: Select/Connect devices:
When want to select/connect to a devices, create a new EthernomAPI instaces to handle the connection.<br />
Parameter: deviceID, deviceName & Callback function<br />
Callback: resultCode
```bash
E_API.Select(deviceID, deviceSN, deviceName, (resultCode) =>{
	if (resultCode == ETH_SUCCESS){
		/*
		...
		Can start write/read card
		...
		*/
	}else{
		//Fails select
	}
}
```
<br />

### How-To: Launch App:
Parameter: Callback function<br />
Callback: resultCode
```bash
E_API.LaunchApp(APP_ID, (resultCode) => {
	if(resultCode == ETH_SUCCESS){
		console.log("Launch success");
		...
		//proceed with APP level protocol
		...
	}else{
		console.log("Launch error");
	}
})
```

<br />

### How-To: Disconnect App:
Parameter: Callback function<br />
Callback: resultCode
```bash
E_API.DisconnectApp((resultCode) => {
	if(resultCode == ETH_SUCCESS){
		console.log("Suspend success");
		...
		//Disconnect soon...
		...
	}else{
		console.log("Suspend error");
	}
})
```

<br />

### How-To: Start encryption traffic:
Parameter: PIN (String, length 6), Callback function<br />
Callback: resultCode
```bash
E_API.DoAppKeyExchange(APP_ID, (resultCode) => {
	if(resultCode == ETH_SUCCESS){
		console.log("Encryption layer success");
		...
		//proceed with APP level protocol
		...
	}else{
		console.log("Encryption layer error");
	}
})
```

<br />

### How-To: Define Application-Level Messages:
```bash
//Options for Outbound message variable types are: 
//	ETH_STRING_AS_HEX, ETH_STRING_AS_ASUTF8, ETH_INT_AS_BYTE, ETH_INT_AS_2BYTE, ETH_INT_AS_4BYTE, ETH_AS_ARRAY
//Outbound message is what will be send to the card
//Each parameter must contains the value
var out_msg = [
	{command: 
		[
			{encoding: ETH_INT_AS_BYTE},
			{value: integer} //(0 ~ 255)
		]
	},
	{PARAMETER1: 
		[
			{encoding: ETH_STRING_AS_ASTUF8},
			{value: "STRING_VALUE"}
		]
	},
	{PARAMETER2:
		[
			{encoding: ETH_STRING_AS_UNICODE},
			{value: "汉字"}
		]
	},
	{PARAMETER3: 
		[
			{encoding: ETH_INT_AS_2BYTE},
			{value: integer} //(0 ~ 65535)
		]
	},
	{PARAMETER4: 
		[
			{encoding: ETH_INT_AS_4BYTE},
			{value: integer} //(0 ~ 4294967295)
		]
	},
	{PARAMETER5: 
		[
			{encoding: ETH_STRING_AS_HEX},
			{value: "00ff..."}
		]
	},
	{PARAMETER6: 
		[
			{encoding: ETH_AS_ARRAY},
			{value: [0, 1, 2, ...]}
		]
	}
]

//Options for Inbound message variable types are: 
//	ETH_UNICODESTRING, ETH_UTF8STRING, ETH_BYTE, ETH_2BYTE, ETH_PAYLOAD
//Inbound message is to define to what's the expected value back from the card, when the EthernomAPI receives the message from card. 
//The EthernomAPI will know which value belongs to which parameter
var in_msg 	= [
	{command : ETH_BYTE},
	{PARAMETER1: ETH_BYTE},
	{PARAMETER2: ETH_2BYTE},
	{PARAMETER3: ETH_UTF8STRING},
	{PARAMETER4: ETH_UNICODESTRING},
	{PAYLOAD: ETH_PAYLOAD} //(Optional)
]
```
<br />

### How-To: How-To: Send/Receive Messages:
Parameter: Outbound Message Struct, Inbound Message Struct & Callback function<br />
Callback: resultCode and Inbound Message
```bash
E_API.WriteJSON(out_msg, in_msg, (resultCode, msg) => {
	if(resultCode == ETH_SUCCESS){
		var msg_obj = JSON.parse(msg);
		console.log(msg_obj.command):
		console.log(msg_obj.PARAMETER1):
		console.log(msg_obj.PARAMETER2):
		console.log(msg_obj.PARAMETER3):
		console.log(msg_obj.PARAMETER4):
		console.log(msg_obj.PAYLOAD):
	}else{
		//Fails write
	}
}
```
<br />

### How-To: How-To: Send/Receive Encrypted Messages:
Prerequisites: Must start DoAppKeyExchange api first
Parameter: Outbound Message Struct, Inbound Message Struct, Encryption (true or false) & Callback function<br />
Callback: resultCode and Inbound Message
```bash
E_API.WriteJSON_Encrypted(out_msg, in_msg, do_encrypt (resultCode, msg) => {
	if(resultCode == ETH_SUCCESS){
		var msg_obj = JSON.parse(msg);
		console.log(msg_obj.command):
		console.log(msg_obj.PARAMETER1):
		console.log(msg_obj.PARAMETER2):
		console.log(msg_obj.PARAMETER3):
		console.log(msg_obj.PARAMETER4):
		console.log(msg_obj.PAYLOAD):
	}else{
		//Fails write
	}
}
```
<br />

### How-To: Subscribe to unsolicted events:
Parameter: deviceID, deviceName, Inbound Message Struct, Callback function<br />
Callback: resultCode and Inbound Message
```bash
E_API.SubscribeToUnsolictedEvents(in_msg, this._on_listener);

_on_listener = (resultCode, msg) => {
	console.log(deviceID);
	console.log(deviceName);
	
	console.log(msg);
	var msg_obj = JSON.parse(msg);
	console.log(msg_obj);
}
```

<br />

### How-To: Unsubscribe to unsolicted events:
```bash
E_API.UnSubscribeToUnsolictedEvents();
```

<br />

### How-To: Card close:
Parameter: Callback function<br />
Callback: resultCode
```bash
E_API.CardClose(this._callback_disconnect);

_callback_disconnect = (resultCode) => {
	if (resultCode == ETH_SUCCESS){
		console.log("Disconnect successfully");
	}else{
		console.log("Fails");
	}
}
```
